# 乐山家具定制报价系统 - 完整搭建提示词

## 项目概述
构建一个完整的家具定制报价系统，包含柜体计算、材质选择、五金件管理、报价生成等功能。

## 核心功能需求

### 1. 柜体计算系统
- **自动计算模式**：输入长宽高，自动计算柜体面积
- **手动输入模式**：直接输入柜体面积
- **柜体面积公式**：顶板+底板+左右侧板+背板+横隔板+竖隔板
- **计算公式**：2×(宽×深) + 2×(深×高) + (宽×高) + 横隔板×(宽×深) + 竖隔板×(深×高)

### 2. 柜门计算系统
- **全覆盖模式**：柜门总面积 = 柜体总宽 × 柜体总高
- **非全覆盖模式**：柜门总面积 = 柜门总宽 × 柜门总高
- **门板数量**：仅用于计算铰链和拉手数量，不影响面积计算

### 3. 五金件计算系统
- **铰链计算**：每扇门配1套铰链，每套铰链个数 = ⌊门高/50⌋ + 1
- **拉手计算**：拉手数量 = 门板数量
- **滑轨计算**：用户手动输入滑轨数量

### 4. 材质管理系统
- **材质分类**：柜体、门板、五金件、玻璃、护墙板、室内门、罗马柱、灯光、石材岩板、橱柜岛台、踢脚线
- **五金件统一管理**：所有五金件（铰链、拉手、滑轨）都在hardware分类中
- **搜索功能**：每个材质选择都支持关键词搜索
- **价格显示**：材质名称、品牌、价格、单位

### 5. 报价系统
- **项目清单**：显示所有添加的项目
- **计算明细**：每个项目的数量、单价、小计
- **总计计算**：自动计算所有项目的小计和总计
- **导出功能**：支持导出报价单

## 技术架构

### 前端技术栈
- **HTML5**：页面结构
- **CSS3**：样式设计，使用CSS变量和现代布局
- **JavaScript ES6+**：交互逻辑和计算功能
- **响应式设计**：支持移动端和桌面端

### 后端技术栈
- **Node.js**：服务器运行环境
- **Express.js**：Web框架
- **MongoDB**：数据库存储材质数据
- **Mongoose**：MongoDB对象建模

### 部署方案
- **GitHub**：代码版本控制
- **Vercel**：前端和后端部署
- **MongoDB Atlas**：云端数据库

## 项目结构

```
乐山家具定制系统-整合版/
├── public/
│   └── index.html          # 主页面文件
├── api/
│   └── index.js           # Vercel API函数
├── server.js              # 本地开发服务器
├── config.js              # 配置文件
├── package.json           # 项目依赖
├── vercel.json            # Vercel部署配置
└── README.md              # 项目说明
```

## 核心代码结构

### 1. HTML结构
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乐山家具定制报价系统</title>
    <style>
        /* CSS样式 */
    </style>
</head>
<body>
    <!-- 页面内容 -->
    <script>
        // JavaScript逻辑
    </script>
</body>
</html>
```

### 2. CSS设计系统
```css
:root {
    --primary-color: #2c3e50;
    --accent-blue: #007aff;
    --accent-green: #34c759;
    --background: #ffffff;
    --surface: #f8f9fa;
    --border-light: #e1e5e9;
    --primary-text: #1d1d1f;
    --secondary-text: #86868b;
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-medium: rgba(0, 0, 0, 0.15);
    --radius-small: 8px;
    --radius-medium: 12px;
}
```

### 3. JavaScript核心功能
```javascript
// 全局变量
let quoteItems = [];
let itemCounter = 0;
let selectedMaterials = {};
let materialDatabase = {};
let isMongoDBConnected = false;

// 核心计算函数
function calculateCabinetArea(width, height, depth, horizontalShelves, verticalShelves) {
    const w = width / 100;
    const h = height / 100;
    const d = depth / 100;
    
    const topBottom = 2 * (w * d);
    const leftRight = 2 * (d * h);
    const back = w * h;
    const horizontalShelvesArea = horizontalShelves * (w * d);
    const verticalShelvesArea = verticalShelves * (d * h);
    
    return topBottom + leftRight + back + horizontalShelvesArea + verticalShelvesArea;
}

function calculateDoorTotalArea(width, height, doors, coverageType, doorWidth, doorHeight) {
    if (coverageType === 'full') {
        const w = width / 100;
        const h = height / 100;
        return w * h;
    } else {
        const dw = doorWidth / 100;
        const dh = doorHeight / 100;
        return dw * dh;
    }
}

function calculateHinges(doors, doorHeight, coverageType, cabinetHeight) {
    if (doors === 0) return 0;
    
    let actualDoorHeight;
    if (coverageType === 'full') {
        actualDoorHeight = cabinetHeight;
    } else {
        actualDoorHeight = doorHeight;
    }
    
    const hingesPerSet = Math.floor(actualDoorHeight / 50) + 1;
    return doors * hingesPerSet;
}

function calculateHandles(doors) {
    return doors;
}
```

### 4. 材质数据管理
```javascript
// 备用数据
function loadFallbackData() {
    materialDatabase = {
        cabinet: [
            { id: 'cab_001', name: '标准密度板 18mm', brand: '乐山家具', price: 280, unit: '元/㎡' },
            { id: 'cab_002', name: '高密度板 18mm', brand: '乐山家具', price: 320, unit: '元/㎡' },
            { id: 'cab_003', name: '实木颗粒板 18mm', brand: '乐山家具', price: 350, unit: '元/㎡' }
        ],
        doorPanel: [
            { id: 'door_001', name: '标准门板 免漆', brand: '乐山家具', price: 320, unit: '元/㎡' },
            { id: 'door_002', name: '吸塑门板 PVC', brand: '乐山家具', price: 380, unit: '元/㎡' }
        ],
        hardware: [
            // 铰链
            { id: 'hinge_001', name: '标准铰链 冷轧钢', brand: '乐山家具', price: 25, unit: '元/个', category: '铰链' },
            { id: 'hinge_002', name: '缓冲铰链 液压', brand: '乐山家具', price: 35, unit: '元/个', category: '铰链' },
            { id: 'hinge_003', name: '阻尼铰链 静音', brand: '乐山家具', price: 45, unit: '元/个', category: '铰链' },
            // 拉手
            { id: 'handle_001', name: '标准拉手 不锈钢', brand: '乐山家具', price: 15, unit: '元/个', category: '拉手' },
            { id: 'handle_002', name: '欧式拉手 铜质', brand: '乐山家具', price: 25, unit: '元/个', category: '拉手' },
            { id: 'handle_003', name: '现代拉手 铝合金', brand: '乐山家具', price: 20, unit: '元/个', category: '拉手' },
            // 滑轨
            { id: 'slide_001', name: '标准滑轨 三节', brand: '乐山家具', price: 35, unit: '元/套', category: '滑轨' },
            { id: 'slide_002', name: '缓冲滑轨 阻尼', brand: '乐山家具', price: 55, unit: '元/套', category: '滑轨' },
            { id: 'slide_003', name: '重型滑轨 承重', brand: '乐山家具', price: 75, unit: '元/套', category: '滑轨' }
        ],
        glass: [
            { id: 'glass_001', name: '透明钢化玻璃 5mm', brand: '乐山家具', price: 120, unit: '元/㎡' },
            { id: 'glass_002', name: '磨砂玻璃 6mm', brand: '乐山家具', price: 150, unit: '元/㎡' }
        ]
        // 其他材质分类...
    };
}
```

### 5. 材质选择功能
```javascript
// 显示材质选项
function showMaterialOptions(type) {
    hideAllMaterialDropdowns();
    
    let materialType = type;
    if (type === 'hinge' || type === 'handle' || type === 'slide') {
        materialType = 'hardware';
    }
    
    const dropdown = document.getElementById(type + 'MaterialDropdown');
    const materials = materialDatabase[materialType] || [];
    
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    
    if (materials.length === 0) {
        dropdown.innerHTML = '<div class="material-option" style="color: var(--secondary-text); text-align: center;">暂无数据</div>';
    } else {
        materials.forEach(material => {
            const option = document.createElement('div');
            option.className = 'material-option';
            option.onclick = () => selectMaterial(type, material);
            
            option.innerHTML = `
                <div class="material-name">${material.name}</div>
                <div class="material-price">¥${material.price}${material.unit.replace('元', '')}</div>
            `;
            
            dropdown.appendChild(option);
        });
    }
    
    dropdown.style.display = 'block';
    dropdown.classList.add('show');
}

// 选择材质
function selectMaterial(type, material) {
    selectedMaterials[type] = material;
    const searchInput = document.getElementById(type + 'MaterialSearch');
    if (searchInput) {
        searchInput.value = `${material.name} - ¥${material.price}${material.unit.replace('元', '')}`;
    }
    hideAllMaterialDropdowns();
}

// 搜索材质
function filterMaterials(type, searchTerm) {
    const dropdown = document.getElementById(type + 'MaterialDropdown');
    if (!dropdown) return;
    
    if (!searchTerm.trim()) {
        showMaterialOptions(type);
        return;
    }
    
    let materialType = type;
    if (type === 'hinge' || type === 'handle' || type === 'slide') {
        materialType = 'hardware';
    }
    
    const materials = materialDatabase[materialType] || [];
    const filteredMaterials = materials.filter(material => 
        material.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        material.brand.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    dropdown.innerHTML = '';
    
    if (filteredMaterials.length === 0) {
        dropdown.innerHTML = '<div class="material-option" style="color: var(--secondary-text); text-align: center;">未找到匹配的材质</div>';
    } else {
        filteredMaterials.forEach(material => {
            const option = document.createElement('div');
            option.className = 'material-option';
            option.onclick = () => selectMaterial(type, material);
            
            let displayName = material.name;
            if (searchTerm && material.name.toLowerCase().includes(searchTerm.toLowerCase())) {
                const regex = new RegExp(`(${searchTerm})`, 'gi');
                displayName = material.name.replace(regex, '<mark>$1</mark>');
            }
            
            option.innerHTML = `
                <div class="material-name">${displayName}</div>
                <div class="material-price">¥${material.price}${material.unit.replace('元', '')}</div>
            `;
            
            dropdown.appendChild(option);
        });
    }
    
    dropdown.style.display = 'block';
    dropdown.classList.add('show');
}
```

## 部署配置

### 1. package.json
```json
{
  "name": "leshan-furniture-system",
  "version": "1.0.0",
  "description": "乐山家具定制报价系统",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.5.0",
    "cors": "^2.8.5"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
```

### 2. vercel.json
```json
{
  "version": 2,
  "builds": [
    {
      "src": "public/**/*",
      "use": "@vercel/static"
    },
    {
      "src": "api/**/*.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/public/$1"
    }
  ]
}
```

### 3. config.js
```javascript
module.exports = {
  mongodb: {
    username: process.env.MONGODB_USERNAME || 'your_username',
    password: process.env.MONGODB_PASSWORD || 'your_password',
    cluster: process.env.MONGODB_CLUSTER || 'your_cluster.mongodb.net',
    defaultDbName: process.env.MONGODB_DATABASE || 'leshan_furniture',
    priceCollectionName: process.env.MONGODB_COLLECTION || 'price_template'
  },
  server: {
    port: process.env.PORT || 3000,
    host: process.env.HOST || '0.0.0.0'
  }
};
```

## 搭建步骤

### 1. 项目初始化
```bash
mkdir 乐山家具定制系统
cd 乐山家具定制系统
npm init -y
npm install express mongoose cors
npm install -D nodemon
```

### 2. 创建文件结构
- 创建 `public/index.html` 主页面
- 创建 `server.js` 服务器文件
- 创建 `config.js` 配置文件
- 创建 `api/index.js` Vercel API函数
- 创建 `vercel.json` 部署配置

### 3. 数据库设置
- 注册MongoDB Atlas账号
- 创建集群和数据库
- 设置环境变量

### 4. 部署到Vercel
- 推送代码到GitHub
- 在Vercel中导入项目
- 设置环境变量
- 部署完成

## 关键特性

### 1. 响应式设计
- 移动端友好的界面
- 自适应布局
- 触摸友好的交互

### 2. 实时计算
- 输入变化时实时更新计算结果
- 动态显示项目清单
- 自动计算总计

### 3. 材质搜索
- 支持关键词搜索
- 高亮显示匹配结果
- 键盘导航支持

### 4. 数据持久化
- MongoDB存储材质数据
- 本地备用数据
- 连接状态显示

### 5. 用户体验
- 清晰的视觉反馈
- 直观的操作流程
- 详细的帮助说明

## 品牌要求
- 必须使用"乐山家具"或"乐山家具定制"品牌名称
- 绝对不允许出现其他品牌名称
- 所有界面、文档、代码中都要确保品牌一致性

## 测试要点
1. 柜体面积计算准确性
2. 柜门面积计算逻辑
3. 五金件数量计算
4. 材质选择功能
5. 搜索功能
6. 报价清单生成
7. 响应式布局
8. 数据加载和错误处理

这个提示词包含了系统的完整架构、核心功能、技术实现和部署方案，可以帮助您快速从0搭建整个系统。
